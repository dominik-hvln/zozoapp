generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model children {
  id             String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id        String        @db.Uuid
  name           String
  created_at     DateTime      @default(now()) @db.Timestamptz(6)
  avatar_url     String?
  date_of_birth  DateTime?     @db.Date
  important_info String?
  illnesses      String?
  allergies      String?
  assignments    assignments[]
  users          users         @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model users {
  id                     String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  email                  String          @unique
  password_hash          String
  first_name             String?
  created_at             DateTime        @default(now()) @db.Timestamptz(6)
  phone                  String?
  role                   String          @default("USER")
  last_name              String?
  trial_expires_at       DateTime?       @db.Timestamptz(6)
  account_status         String          @default("TRIAL")
  stripe_customer_id     String?
  password_reset_token   String?
  password_reset_expires DateTime?       @db.Timestamptz(6)
  avatar_url             String?
  assignments            assignments[]
  carts                  carts?
  children               children[]
  device_tokens          device_tokens[]
  notifications          notifications[]
  orders                 orders[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model assignments {
  id                 String           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id            String           @db.Uuid
  child_id           String           @db.Uuid
  tattoo_instance_id String           @db.Uuid
  custom_message     String?
  is_active          Boolean          @default(true)
  created_at         DateTime         @default(now()) @db.Timestamptz(6)
  order_item_id      String?          @db.Uuid
  children           children         @relation(fields: [child_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  order_items        order_items?     @relation(fields: [order_item_id], references: [id], onUpdate: NoAction)
  tattoo_instances   tattoo_instances @relation(fields: [tattoo_instance_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users              users            @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  scans              scans[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tattoo_instances {
  id          String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  unique_code String        @unique
  status      String        @default("new")
  created_at  DateTime      @default(now()) @db.Timestamptz(6)
  assignments assignments[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model scans {
  id            String      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  assignment_id String      @db.Uuid
  scan_time     DateTime    @default(now()) @db.Timestamptz(6)
  ip_address    String?
  user_agent    String?
  latitude      Float?      @db.Real
  longitude     Float?      @db.Real
  assignments   assignments @relation(fields: [assignment_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model products {
  id                String             @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name              String
  description       String?
  is_active         Boolean            @default(true)
  stripe_product_id String?
  created_at        DateTime           @default(now()) @db.Timestamptz(6)
  image_url         String?
  cart_items        cart_items[]
  product_variants  product_variants[]
  categories        categories[]       @relation("CategoryToProduct")
}

model cart_items {
  id         String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  cart_id    String   @db.Uuid
  product_id String   @db.Uuid
  quantity   Int      @default(1)
  carts      carts    @relation(fields: [cart_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  products   products @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([cart_id, product_id])
}

model carts {
  id         String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id    String       @unique @db.Uuid
  cart_items cart_items[]
  users      users        @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model product_variants {
  id              String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  product_id      String        @db.Uuid
  quantity        Int
  price           Int
  stripe_price_id String        @unique
  created_at      DateTime      @default(now()) @db.Timestamptz(6)
  order_items     order_items[]
  products        products      @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model categories {
  id       String     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name     String     @unique
  products products[] @relation("CategoryToProduct")
}

model order_items {
  id                 String           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  order_id           String           @db.Uuid
  product_variant_id String           @db.Uuid
  quantity           Int
  price              Int
  assignments        assignments[]
  orders             orders           @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product_variants   product_variants @relation(fields: [product_variant_id], references: [id], onDelete: SetNull, onUpdate: NoAction)
}

model orders {
  id                 String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id            String        @db.Uuid
  stripe_checkout_id String        @unique
  total_amount       Int
  created_at         DateTime      @default(now()) @db.Timestamptz(6)
  order_items        order_items[]
  users              users         @relation(fields: [user_id], references: [id], onDelete: SetNull, onUpdate: NoAction)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model notifications {
  id         String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id    String   @db.Uuid
  type       String
  title      String
  message    String?
  is_read    Boolean  @default(false)
  created_at DateTime @default(now()) @db.Timestamptz(6)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model device_tokens {
  id         String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id    String   @db.Uuid
  token      String   @unique
  created_at DateTime @default(now()) @db.Timestamptz(6)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model discount_codes {
  id         String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  code       String        @unique
  type       discount_type
  value      Int
  is_active  Boolean       @default(true)
  expires_at DateTime?     @db.Timestamptz(6)
  created_at DateTime      @default(now()) @db.Timestamptz(6)
}

enum discount_type {
  PERCENTAGE
  FIXED_AMOUNT
}
